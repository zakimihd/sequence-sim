<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>自己保持回路シミュレーター（押しボタン1=保持ON／押しボタン2=保持OFF）</title>
  <style>
    :root{
      --bg:#0f172a;--panel:#0b1222;--border:#1f2937;--text:#e5e7eb;--muted:#9ca3af;
      --primary:#0ea5e9;--primary2:#0284c7;--lamp-off:#374151;--lamp-on:#fde047;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(70vw 70vh at 50% -10%,#1f2937,var(--bg));
      color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN",Meiryo,sans-serif;
      display:grid;place-items:center}
    .app{width:min(920px,96vw);padding:20px;border-radius:18px;background:linear-gradient(180deg,var(--panel),#0b1222cc);
      border:1px solid var(--border);box-shadow:0 10px 30px #0008,inset 0 1px 0 #ffffff11}
    header{display:flex;flex-wrap:wrap;gap:8px 16px;align-items:baseline;justify-content:space-between}
    h1{font-size:clamp(20px,3.2vw,28px);margin:0;letter-spacing:.02em}
    .sub{color:var(--muted);font-size:.95rem}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:clamp(16px,3vw,28px);margin-top:18px;align-items:center}
    @media (max-width:720px){.grid{grid-template-columns:1fr}}

    .lamp-wrap{display:grid;place-items:center;padding:12px}
    .lamp{width:clamp(120px,28vw,200px);height:clamp(120px,28vw,200px);border-radius:50%;
      background:radial-gradient(circle at 50% 60%,#4b5563,var(--lamp-off));
      border:10px solid #111827;box-shadow:inset 0 -12px 20px #000a,inset 0 6px 20px #fff2;
      transition:transform .1s ease}
    .lamp.on{background:radial-gradient(circle at 50% 60%,#fff7,var(--lamp-on));
      box-shadow:0 0 60px 15px rgba(253,224,71,.25),0 0 140px 40px rgba(253,224,71,.15),
                 inset 0 -8px 18px #0006,inset 0 6px 22px #fff3;transform:translateY(-2px)}
    .indicator{text-align:center;margin-top:10px;color:var(--muted);font-feature-settings:"tnum"}

    .controls{display:grid;gap:16px;justify-items:center;padding:16px;border:1px solid var(--border);
      border-radius:14px;background:#0b1222aa}
    .row{display:flex;gap:14px;flex-wrap:wrap;justify-content:center}

    .btn{user-select:none;-webkit-tap-highlight-color:transparent;min-width:220px;height:clamp(56px,11vh,100px);
      border:0;border-radius:14px;background:linear-gradient(180deg,var(--primary),var(--primary2));
      color:#fff;font-weight:800;font-size:clamp(16px,3.4vw,24px);letter-spacing:.04em;padding:12px 18px;
      box-shadow:0 8px 20px #0008,inset 0 1px 0 #ffffff66;transition:transform .02s ease,filter .15s ease}
    .btn:active,.btn.is-down{transform:translateY(2px);filter:brightness(.95)}
    .btn.off{background:linear-gradient(180deg,#ef4444,#b91c1c)}

    details{margin-top:14px;border:1px solid var(--border);border-radius:12px;background:#0b1222aa}
    summary{cursor:pointer;padding:10px 14px;color:var(--muted)}
    .schem{padding:0 14px 12px 14px;color:#cbd5e1;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace;font-size:.95rem}
    .kbd{display:inline-block;padding:2px 6px;border-radius:6px;border:1px solid #2b2f3a;background:#131826;color:#e5e7eb;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace}
    footer{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;color:var(--muted);font-size:.9rem}
    .tag{padding:4px 8px;border:1px solid var(--border);border-radius:999px}
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="自己保持回路シミュレーター">
    <header>
      <h1>自己保持回路シミュレーター</h1>
      <div class="sub">押しボタン1で<strong>自己保持（シールイン）ON</strong>／押しボタン2で<strong>保持解除（OFF）</strong></div>
    </header>

    <div class="grid">
      <div class="lamp-wrap">
        <div id="lamp" class="lamp" role="img" aria-label="パイロットランプ（消灯）" aria-live="polite"></div>
        <div id="indicator" class="indicator">状態：消灯</div>
      </div>

      <div class="controls">
        <div class="row">
          <button id="btnOn" class="btn" aria-label="押しボタン1（ON）" aria-pressed="false">押しボタン1（ON）</button>
          <button id="btnOff" class="btn off" aria-label="押しボタン2（OFF）" aria-pressed="false">押しボタン2（OFF）</button>
        </div>
        <div class="indicator">タッチ/クリックで瞬時押し。キーボード <span class="kbd">Space</span> / <span class="kbd">Enter</span> でも操作できます（フォーカス中）。</div>
        <details>
          <summary>回路の考え方（ラダー図イメージ）を表示</summary>
          <pre class="schem">|---[ 押1 NO ]---+---------( M : 主回路コイル )
|                 |
|                 +---[ M の自己保持接点 NO ]---|
|
|---[ 押2 NC ]-----------------------------------|

M が励磁すると M の自己保持接点(並列)が閉じて押1を離しても通電が継続。
押2（非常停止相当/停止ボタン）の NC で回路を遮断すると M が落ち、保持解除。</pre>
        </details>
      </div>
    </div>

    <footer>
      <div class="tag"># タッチ対応</div>
      <div class="tag"># Chromebook対応</div>
      <div class="tag"># アクセシビリティ対応</div>
    </footer>
  </div>

  <script>
    (()=>{
      const lamp = document.getElementById('lamp');
      const indicator = document.getElementById('indicator');
      const btnOn = document.getElementById('btnOn');
      const btnOff = document.getElementById('btnOff');

      let lampState = false; // パイロットランプ（= 主回路 M の状態）

      const render = ()=>{
        if(lampState){
          lamp.classList.add('on');
          lamp.setAttribute('aria-label','パイロットランプ（点灯）');
          indicator.textContent = '状態：点灯（保持中）';
        }else{
          lamp.classList.remove('on');
          lamp.setAttribute('aria-label','パイロットランプ（消灯）');
          indicator.textContent = '状態：消灯';
        }
      };

      // 押しボタン1（瞬時→自己保持ON）
      const pressOn = ()=>{ btnOn.classList.add('is-down'); btnOn.setAttribute('aria-pressed','true'); lampState = true; render(); };
      const releaseOn = ()=>{ btnOn.classList.remove('is-down'); btnOn.setAttribute('aria-pressed','false'); };

      // 押しボタン2（瞬時→保持解除OFF）
      const pressOff = ()=>{ btnOff.classList.add('is-down'); btnOff.setAttribute('aria-pressed','true'); lampState = false; render(); };
      const releaseOff = ()=>{ btnOff.classList.remove('is-down'); btnOff.setAttribute('aria-pressed','false'); };

      // Pointer events（タッチ/マウス/ペン共通）
      btnOn.addEventListener('pointerdown', e=>{ btnOn.setPointerCapture?.(e.pointerId); pressOn(); });
      btnOn.addEventListener('pointerup',   e=>{ releaseOn(); });
      btnOn.addEventListener('pointercancel', e=>{ releaseOn(); });
      btnOn.addEventListener('pointerleave',  e=>{ releaseOn(); });

      btnOff.addEventListener('pointerdown', e=>{ btnOff.setPointerCapture?.(e.pointerId); pressOff(); });
      btnOff.addEventListener('pointerup',   e=>{ releaseOff(); });
      btnOff.addEventListener('pointercancel', e=>{ releaseOff(); });
      btnOff.addEventListener('pointerleave',  e=>{ releaseOff(); });

      // キーボード操作（フォーカス中、Space/Enterで瞬時押し）
      const keyHandler = (el, press, release)=>{
        el.addEventListener('keydown', e=>{
          if(e.code==='Space' || e.code==='Enter'){ press(); e.preventDefault(); }
        });
        el.addEventListener('keyup', e=>{
          if(e.code==='Space' || e.code==='Enter'){ release(); e.preventDefault(); }
        });
      };
      keyHandler(btnOn, pressOn, releaseOn);
      keyHandler(btnOff, pressOff, releaseOff);

      // 安全措置：タブ切替等で押下見失い防止
      window.addEventListener('blur', ()=>{ releaseOn(); releaseOff(); });

      render();
    })();
  </script>
</body>
</html>