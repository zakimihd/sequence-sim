<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>検定盤シミュレーション（NOT回路：PB1→!PL1）</title>
  <style>
    :root {
      --panel-max-width: 900px;
    }
    html, body {
      margin: 0;
      height: 100%;
      background: #0b0b0c;
      color: #e7e7e7;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans JP", sans-serif;
    }
    .wrap { min-height: 100%; display: grid; place-items: center; padding: 16px; }

    .panel { position: relative; width: min(96vw, var(--panel-max-width)); }
    .panel > img {
      display: block;
      width: 100%;
      height: auto;
      object-fit: contain;
      user-select: none;
      pointer-events: none;
      border-radius: 12px;
      box-shadow: 0 20px 50px rgba(0,0,0,.45);
    }

    .layer { position: absolute; inset: 0; }
    .indicators { pointer-events: none; }

    /* PL1 表示（丸ランプ）。位置は%で指定（画像スケールに追従） */
    .pl1 { position: absolute;  width: 5px;height: 5px;transform: translate(-50%, -50%); border-radius: 100px; transition: box-shadow .1s linear, background .1s linear, opacity .1s linear; }
    .pl1.on  { background: rgba(34, 197, 94, 0.95); box-shadow: 0 0 12px rgba(34, 197, 94, 0.95); }
    .pl1.off { background: rgba(212,212,212,0.55); box-shadow: none; }


    /* 透明ヒットボックス（PB1）。開発時だけ枠を出せる */
    .hitbox { position: absolute; transform: translate(-50%, -50%); background: transparent; border: none; cursor: pointer; }
    .hitbox.debug { background: rgba(14,165,233,0.12); outline: 2px solid rgba(14,165,233,0.7); }



    /* 下部バー */
    .bar {
      display:flex; gap: 12px; align-items:center; justify-content:space-between;
      width:min(96vw, var(--panel-max-width));
      margin: 10px auto 0;
      font-size: 14px;
      color:#cfcfcf;
    }
    .bar label { display:flex; align-items:center; gap:.5em; font-size: 13px; opacity:.9 }
    .kbd { background:#16181d; border:1px solid #2a2d34; padding:2px 6px; border-radius:6px; font-size: 12px; }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="panel" id="panel">
      <img id="panelImage" src="./panel.png" alt="検定盤（実写）" />

      <!-- PL1（常時点灯／PB1押下で消灯） -->
      <div class="layer indicators">
        <div id="pl1" class="pl1 on" title="PL1（常時点灯／PB1押下で消灯）"></div>
      </div>

      <!-- PB1（押すとON） -->
      <div class="layer" id="inputs">
        <button id="pb1" class="hitbox" title="PB1（押している間ON）" aria-label="PB1"></button>
      </div>
    </section>

    <div class="bar">
      <div>
        PB1: <span id="pb1State">OFF</span>／ PL1: <span id="pl1State">点灯</span>
      </div>
      <div>
        操作: <span class="kbd">C</span> 長押し も可
      </div>
      <label><input type="checkbox" id="toggleDebug" /> ヒットボックス表示</label>
    </div>
  </main>

  <script>
    // --- ON回路と同じ位置設定 ---
    const POS = {
      pl1: { left: 30, top: 69.5, size: 2 },
      pb1: { left: 30, top: 82.0, width: 6, height: 4 },
    };

    const $ = (sel) => document.querySelector(sel);
    const pl1El = $('#pl1');
    const pb1El = $('#pb1');
    const pb1State = $('#pb1State');
    const pl1State = $('#pl1State');
    const debugSwitch = $('#toggleDebug');

    function applyPositions() {
      pl1El.style.left = POS.pl1.left + '%';
      pl1El.style.top = POS.pl1.top + '%';
      pl1El.style.width = POS.pl1.size + '%';
      pl1El.style.height = POS.pl1.size + '%';

      pb1El.style.left = POS.pb1.left + '%';
      pb1El.style.top = POS.pb1.top + '%';
      pb1El.style.width = POS.pb1.width + '%';
      pb1El.style.height = POS.pb1.height + '%';
    }

    // --- NOT回路動作 ---
    let pb1Pressed = false;
    function updateOutputs() {
      pb1State.textContent = pb1Pressed ? 'ON（押下中）' : 'OFF';
      const on = !pb1Pressed; // 反転動作
      pl1El.classList.toggle('on', on);
      pl1El.classList.toggle('off', !on);
      pl1State.textContent = on ? '点灯' : '消灯';
    }

    // --- PB1（マウス・タッチ） ---
    pb1El.addEventListener('pointerdown', () => { pb1Pressed = true; updateOutputs(); });
    pb1El.addEventListener('pointerup',   () => { pb1Pressed = false; updateOutputs(); });
    pb1El.addEventListener('pointerleave',() => { pb1Pressed = false; updateOutputs(); });

// キーボード操作（CキーでPB1を操作）
window.addEventListener('keydown', (e) => {
  if (e.repeat) return;
  if (e.key === 'c' || e.key === 'C') {
    pb1Pressed = true;
    updateOutputs();
  }
});

window.addEventListener('keyup', (e) => {
  if (e.key === 'c' || e.key === 'C') {
    pb1Pressed = false;
    updateOutputs();
  }
});

// 念のため：ウィンドウ外にフォーカスが移動したらOFFに戻す
window.addEventListener('blur', () => {
  if (pb1Pressed) {
    pb1Pressed = false;
    updateOutputs();
  }
});


    // --- デバッグスイッチ ---
    debugSwitch.addEventListener('change', () => {
      pb1El.classList.toggle('debug', debugSwitch.checked);
    });

    // --- 初期化 ---
    applyPositions();
    updateOutputs();
  </script>
</body>
</html>
