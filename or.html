<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>検定盤シミュレーション（OR回路：PB1 ∨ PB2 → PL1）</title>
  <style>
    :root { --panel-max-width: 900px; }
    html, body {
      margin: 0; height: 100%;
      background: #0b0b0c; color: #e7e7e7;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans JP", sans-serif;
    }
    .wrap { min-height: 100%; display: grid; place-items: center; padding: 16px; }

    .panel { position: relative; width: min(96vw, var(--panel-max-width)); }
    .panel > img {
      display: block; width: 100%; height: auto; object-fit: contain;
      user-select: none; pointer-events: none;
      border-radius: 12px; box-shadow: 0 20px 50px rgba(0,0,0,.45);
    }

    .layer { position: absolute; inset: 0; }
    .indicators { pointer-events: none; }

    /* PL1 表示（丸ランプ）。位置は%で指定（画像スケールに追従） */
    .pl1 { position: absolute;  width: 5px;height: 5px;transform: translate(-50%, -50%); border-radius: 100px; transition: box-shadow .1s linear, background .1s linear, opacity .1s linear; }
    .pl1.on  { background: rgba(34, 197, 94, 0.95); box-shadow: 0 0 12px rgba(34, 197, 94, 0.95); }
    .pl1.off { background: rgba(212,212,212,0.55); box-shadow: none; }

    /* PBヒットボックス（透明ボタン） */
    .hitbox {
      position: absolute; transform: translate(-50%, -50%);
      background: transparent; border: none; cursor: pointer;
    }
    .hitbox.debug { background: rgba(14,165,233,0.12); outline: 2px solid rgba(14,165,233,0.7); }

    /* 下部バー */
    .bar {
      display:flex; gap: 12px; align-items:center; justify-content:space-between;
      width:min(96vw, var(--panel-max-width)); margin: 10px auto 0;
      font-size: 14px; color:#cfcfcf;
    }
    .bar label { display:flex; align-items:center; gap:.5em; font-size: 13px; opacity:.9 }
    .kbd { background:#16181d; border:1px solid #2a2d34; padding:2px 6px; border-radius:6px; font-size: 12px; }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="panel" id="panel">
      <!-- 同じフォルダに panel.png を置いてください -->
      <img id="panelImage" src="./panel.png" alt="検定盤（実写）" />

      <!-- 表示レイヤ（PL1） -->
      <div class="layer indicators">
        <div id="pl1" class="pl1 off" title="PL1（PB1∨PB2で点灯）"></div>
      </div>

      <!-- クリックレイヤ（PB1, PB2） -->
      <div class="layer" id="inputs">
        <button id="pb1" class="hitbox" title="PB1（押している間ON）" aria-label="PB1"></button>
        <button id="pb2" class="hitbox" title="PB2（押している間ON）" aria-label="PB2"></button>
      </div>
    </section>

    <div class="bar">
      <div>
        PB1: <span id="pb1State">OFF</span>／
        PB2: <span id="pb2State">OFF</span>／
        PL1: <span id="pl1State">消灯</span>
      </div>
      <div>
        操作: PB1=<span class="kbd">C</span> ／ PB2=<span class="kbd">V</span>（長押し可）
      </div>
      <label><input type="checkbox" id="toggleDebug" /> ヒットボックス表示</label>
    </div>
  </main>

  <script>
    // === 位置（%）: AND回路から流用（同じUI配置のまま） ===
    const POS = {
      pl1: { left: 30, top: 69.5, size: 2 },
      pb1: { left: 30, top: 82.0, width: 6, height: 4 },
      pb2: { left: 38.0, top: 82.0, width: 6, height: 4 },
    };

    const $ = (sel) => document.querySelector(sel);
    const pl1El = $('#pl1');
    const pb1El = $('#pb1');
    const pb2El = $('#pb2');
    const pb1State = $('#pb1State');
    const pb2State = $('#pb2State');
    const pl1State = $('#pl1State');
    const debugSwitch = $('#toggleDebug');

    // 位置を適用
    function applyPositions() {
      // PL1
      pl1El.style.left = POS.pl1.left + '%';
      pl1El.style.top  = POS.pl1.top  + '%';
      pl1El.style.width  = POS.pl1.size + '%';
      pl1El.style.height = POS.pl1.size + '%';

      // PB1
      pb1El.style.left = POS.pb1.left + '%';
      pb1El.style.top  = POS.pb1.top  + '%';
      pb1El.style.width  = POS.pb1.width + '%';
      pb1El.style.height = POS.pb1.height + '%';

      // PB2
      pb2El.style.left = POS.pb2.left + '%';
      pb2El.style.top  = POS.pb2.top  + '%';
      pb2El.style.width  = POS.pb2.width + '%';
      pb2El.style.height = POS.pb2.height + '%';
    }

    // 入力状態
    let pb1Pressed = false;
    let pb2Pressed = false;

    // 出力更新（OR回路：PB1 ∨ PB2）
    function updateOutputs() {
      pb1State.textContent = pb1Pressed ? 'ON（押下中）' : 'OFF';
      pb2State.textContent = pb2Pressed ? 'ON（押下中）' : 'OFF';

      const on = pb1Pressed || pb2Pressed; // ← ここを OR（||）に変更
      pl1El.classList.toggle('on', on);
      pl1El.classList.toggle('off', !on);
      pl1State.textContent = on ? '点灯' : '消灯';
    }

    // ポインタイベント共通ハンドラ
    function pressPB(which, pressed) {
      if (which === 1) pb1Pressed = pressed;
      if (which === 2) pb2Pressed = pressed;
      updateOutputs();
    }

    // PB1
    pb1El.addEventListener('pointerdown', () => pressPB(1, true));
    pb1El.addEventListener('pointerup',   () => pressPB(1, false));
    pb1El.addEventListener('pointerleave',() => pressPB(1, false));
    pb1El.addEventListener('pointercancel',() => pressPB(1, false));

    // PB2
    pb2El.addEventListener('pointerdown', () => pressPB(2, true));
    pb2El.addEventListener('pointerup',   () => pressPB(2, false));
    pb2El.addEventListener('pointerleave',() => pressPB(2, false));
    pb2El.addEventListener('pointercancel',() => pressPB(2, false));

    // キーボード：PB1=C, PB2=V（同時押しOK / 長押し可）
    window.addEventListener('keydown', (e) => {
      if (e.repeat) return;
      if (e.key === 'c') pressPB(1, true);
      if (e.key === 'v') pressPB(2, true);
    });
    window.addEventListener('keyup', (e) => {
      if (e.key === 'c') pressPB(1, false);
      if (e.key === 'v') pressPB(2, false);
    });

    // デバッグ（ヒットボックス可視化）
    const toggleDebug = () => {
      const on = debugSwitch.checked;
      pb1El.classList.toggle('debug', on);
      pb2El.classList.toggle('debug', on);
    };
    debugSwitch.addEventListener('change', toggleDebug);

    // 初期化
    applyPositions();
    updateOutputs();
  </script>
</body>
</html>
